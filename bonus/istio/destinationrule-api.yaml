apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: api
  namespace: app
  labels:
    app.kubernetes.io/part-of: kubiquest
spec:
  host: api-service
  trafficPolicy:
    # mTLS activé côté client pour l'API
    tls:
      mode: ISTIO_MUTUAL
    # Circuit breaker : évite les cascades de pannes
    outlierDetection:
      consecutive5xxErrors: 5
      interval: 10s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
    # Connection pool : limite les connexions simultanées
    connectionPool:
      http:
        http1MaxPendingRequests: 100
        http2MaxRequests: 200
